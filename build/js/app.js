function Map(){"use strict";var e=this;e.map,e.center={},e.zipCode,e.searchBox=new google.maps.places.SearchBox(document.getElementById("pac-input")),e.geocoder=new google.maps.Geocoder,e.viewModel={googleMap:ko.observable({lat:ko.observable(),lng:ko.observable()}),address:ko.observable(),meetups:meetup.viewModel.meetups,markers:meetup.viewModel.markers,clickMarker:function(o){for(var n in e.viewModel.markers()){var t=e.viewModel.markers()[n];t.open&&(t.open=!1,t.info.close()),t.id==o.id&&(t.open=!0,t.info.open(e.map,t))}}},e.getCurrentPosition=function(){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(o){var n=o.coords.latitude,t=o.coords.longitude;e.viewModel.googleMap().lat(n),e.viewModel.googleMap().lng(t),e.getLocationFromLatLng(n,t)},function(){e.setDefaultPosition()}):e.setDefaultPosition()},e.getLocationFromLatLng=function(o,n){var t=new google.maps.LatLng(o,n);e.geocoder.geocode({latLng:t},function(o,n){if(n==google.maps.GeocoderStatus.OK){for(var t="",a=0,r=o[0].address_components.length;r>a;a++)"locality"===o[0].address_components[a].types[0]&&(t+=o[0].address_components[a].long_name+", "),"administrative_area_level_1"===o[0].address_components[a].types[0]&&(t+=o[0].address_components[a].short_name+" "),"postal_code"===o[0].address_components[a].types[0]&&(e.zipCode=o[0].address_components[a].long_name,t+=o[0].address_components[a].long_name);e.viewModel.address(t),meetup.viewModel.meetups([]);for(var s=0,r=meetup.viewModel.markers().length;r>s;s++)meetup.viewModel.markers()[s].setMap(null);meetup.viewModel.markers([]),meetup.getUpcomingMeetups(10,e.zipCode,e.map)}})},e.setDefaultPosition=function(){e.viewModel.googleMap().lat(40.015),e.viewModel.googleMap().lng(-105.27),e.getLocationFromLatLng(e.viewModel.googleMap().lat(),e.viewModel.googleMap().lng())},ko.bindingHandlers.map={init:function(o,n,t,a){var r=ko.utils.unwrapObservable(n()),s=new google.maps.LatLng(ko.utils.unwrapObservable(r.lat),ko.utils.unwrapObservable(r.lng)),i={center:s,zoom:12,zoomControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT},panControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT},mapTypeId:google.maps.MapTypeId.ROADMAP};r.googleMap=new google.maps.Map(o,i),e.map=r.googleMap,r.onChangeCoord=function(o){var n=new google.maps.LatLng(ko.utils.unwrapObservable(r.lat),ko.utils.unwrapObservable(r.lng));r.googleMap.setCenter(n),e.center=r.googleMap.getCenter(),e.getLocationFromLatLng(e.center.A,e.center.F)},google.maps.event.addListener(r.googleMap,"dragend",function(){e.center=r.googleMap.getCenter(),e.getLocationFromLatLng(e.center.A,e.center.F)}),google.maps.event.addListener(e.searchBox,"places_changed",function(){var o=e.searchBox.getPlaces(),n=o[0].geometry.location.A,t=o[0].geometry.location.F;e.getLocationFromLatLng(n,t),e.viewModel.googleMap().lat(n),e.viewModel.googleMap().lng(t)}),r.lat.subscribe(r.onChangeCoord),r.lng.subscribe(r.onChangeCoord)}}}var today=moment(Date.now()),meetup={key:"82d672183c733619762e644e64e2c",viewModel:{meetups:ko.observableArray([]),markers:ko.observableArray([])},getUpcomingMeetups:function(e,o,n){var t="https://api.meetup.com/2/open_events?sign=true&photo-host=public&status=upcoming&zip="+o+"&radius="+e+"&key="+meetup.key;$.ajax({url:t,crossDomain:!0,dataType:"jsonp",success:function(e){$.each(e.results,function(e,o){o.hasOwnProperty("venue")&&(meetup.viewModel.meetups.push(o),meetup.viewModel.markers.push(meetup.createMarker(o,n)))})},error:function(e){$("#results").text("Failed retrieving results from the Meetup API")}})},createMarker:function(e,o){var n,t=new google.maps.LatLng(e.venue.lat,e.venue.lon),a=moment(e.time).toDate(),r=moment(a).isSame(today,"day");n=r?"icons/today1.png":moment(a).subtract(7,"days")<=moment(today)?"icons/marker-th.png":"icons/map-pin-red-th.png",a=moment(a).format("MMMM Do YYYY, h:mm a");var s=new google.maps.Marker({position:t,map:o,icon:n});r&&s.setAnimation(google.maps.Animation.BOUNCE);var i='<div class="infowindow"><a href="'+e.event_url+'" target="_blank" class="eventurl"><h1>'+e.name+"</h1></a><p><strong>"+a+'</strong>,&nbsp;<a href="http://www.meetup.com/'+e.group.urlname+'" target="_blank">'+e.group.name+"</a></p><p>"+e.venue.address_1+"&nbsp;"+e.venue.city+", "+e.venue.state+"</p><p>"+e.description+"</p></div>";return s.info=new google.maps.InfoWindow({content:i}),s.id=e.id,s.date=a,s.open=!1,google.maps.event.addListener(s.info,"closeclick",function(){s.open=!1}),google.maps.event.addListener(s,"click",function(){for(var e in meetup.viewModel.markers())meetup.viewModel.markers()[e].id!=s.id&&(meetup.viewModel.markers()[e].open=!1,meetup.viewModel.markers()[e].info.close());s.open?(s.open=!1,s.info.close()):(s.open=!0,s.info.open(o,s))}),s}};ko.bindingHandlers.dateString={init:function(e,o,n,t,a){var r=ko.unwrap(o());r=moment(r).toDate(),$(e).text(moment(r).format("MMMM Do YYYY, h:mm a"))}},function(){"use strict";$(document).ready(function(){$(document).ajaxStart(function(){$("#loading").show()}),$(document).ajaxStop(function(){$("#loading").hide()});var e=new Map;e.getCurrentPosition(),ko.applyBindings(e.viewModel)})}();